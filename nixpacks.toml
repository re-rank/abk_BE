# Nixpacks 빌드 설정 - Playwright Chromium 지원

[phases.setup]
# 시스템 의존성 설치를 위한 기본 패키지
aptPkgs = ["curl", "wget", "ca-certificates"]
cmds = [
  "apt-get update",
  "apt-get install -y libnss3 libnspr4 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 libdbus-1-3 libxkbcommon0 libatspi2.0-0 libxcomposite1 libxdamage1 libxfixes3 libxrandr2 libgbm1 libpango-1.0-0 libcairo2 libasound2 libxcb1 libx11-6 libx11-xcb1 fonts-liberation || true"
]

[phases.install]
cmds = [
  "npm ci",
  "PLAYWRIGHT_BROWSERS_PATH=/app/.cache/ms-playwright npx playwright install chromium",
  "npx playwright install-deps chromium || true"
]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "npm run start:prod"

[variables]
PLAYWRIGHT_BROWSERS_PATH = "/app/.cache/ms-playwright"
NODE_ENV = "production"
